<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spring.mvc.drafting_doc.Drafting_Dao">
	<select id="selectAll" resultType="com.spring.mvc.drafting_doc.Drafting_Dto">
		SELECT DRAFTING_DOC.DRAFTING_NUM, DRAFTING_DOC.DRAFTING_TITLE, DRAFTING_DOC.DRAFTING_CONTENT, DRAFTING_DOC.DRAFTING_DATE, DRAFTING_DOC.APPROVAL_CATEGORY_NUM, DRAFTING_DOC.MEMBER_ID, CONDITION.CONDITION_NAME
		FROM DRAFTING_DOC,CONDITION
		WHERE DRAFTING_DOC.CONDITION_NUM = CONDITION.CONDITION_NUM
	</select>
	
	<insert id = "insert" >
		INSERT INTO DRAFTING_DOC(DRAFTING_NUM,DRAFTING_TITLE,DRAFTING_CONTENT,DRAFTING_DATE,APPROVAL_CATEGORY_NUM,MEMBER_ID,CONDITION_NUM)
		VALUES (SEQ_DRAFTING_DOC.NEXTVAL,#{param1},#{param2},sysdate,1,#{param3},1)
	</insert>
	
	<select id = "select" resultType="com.spring.mvc.drafting_doc.Drafting_Dto">
		SELECT * 
		FROM DRAFTING_DOC,POSITION,MEMBER
		WHERE DRAFTING_DOC.MEMBER_ID = MEMBER.MEMBER_ID AND MEMBER.POSITION_NUM = POSITION.POSITION_NUM AND DRAFTING_DOC.DRAFTING_NUM = #{param1}	
	</select>
	
	<delete id = "delete" >
		DELETE FROM DRAFTING_DOC WHERE DRAFTING_NUM = #{param1}
	</delete>
	
	<update id = "update">
		UPDATE DRAFTING_DOC SET 
		DRAFTING_TITLE = #{param2},
		DRAFTING_CONTENT = #{param3}
		WHERE DRAFTING_NUM = #{param1}
	
	</update>
	<update id = "approval">
		UPDATE DRAFTING_DOC SET 
		CONDITION_NUM = 2
		WHERE DRAFTING_NUM = #{param1}
	</update>
 	<update id = "returnapproval">
		UPDATE DRAFTING_DOC SET 
		CONDITION_NUM = 3
		WHERE DRAFTING_NUM = #{param1}
	</update>
	
	<select id="selectByCondition" resultType="com.spring.mvc.drafting_doc.Drafting_Dto">
		SELECT DRAFTING_DOC.DRAFTING_NUM, DRAFTING_DOC.DRAFTING_TITLE, DRAFTING_DOC.DRAFTING_CONTENT, DRAFTING_DOC.DRAFTING_DATE, DRAFTING_DOC.APPROVAL_CATEGORY_NUM, DRAFTING_DOC.MEMBER_ID, CONDITION.CONDITION_NAME
		FROM DRAFTING_DOC,CONDITION
		WHERE DRAFTING_DOC.CONDITION_NUM = CONDITION.CONDITION_NUM AND (CONDITION.CONDITION_NUM = 1 or CONDITION.CONDITION_NUM = 3)
		ORDER BY DRAFTING_DOC.DRAFTING_DATE DESC
	</select>
	
	<select id="selectByComplite" resultType="com.spring.mvc.drafting_doc.Drafting_Dto">
		SELECT DRAFTING_DOC.DRAFTING_NUM, DRAFTING_DOC.DRAFTING_TITLE, DRAFTING_DOC.DRAFTING_CONTENT, DRAFTING_DOC.DRAFTING_DATE, DRAFTING_DOC.APPROVAL_CATEGORY_NUM, DRAFTING_DOC.MEMBER_ID,MEMBER.MEMBER_ID, CONDITION.CONDITION_NAME, GROUP_TB.GROUP_NUM, GROUP_TB.GROUP_NAME, POSITION.POSITION_NUM, POSITION.POSITION_NAME, MEMBER.MEMBER_NAME 
		 FROM DRAFTING_DOC, CONDITION, GROUP_TB, POSITION, MEMBER 
		 WHERE DRAFTING_DOC.CONDITION_NUM = CONDITION.CONDITION_NUM  AND MEMBER.GROUP_NUM = GROUP_TB.GROUP_NUM AND MEMBER.POSITION_NUM = POSITION.POSITION_NUM AND MEMBER.MEMBER_ID = DRAFTING_DOC.MEMBER_ID
		 AND ((CONDITION.CONDITION_NUM = 2) AND ( MEMBER.MEMBER_ID = #{param1}  or (#{param2} = GROUP_TB.GROUP_NUM AND #{param3} >=3) or #{param3} >= 4))  
		 ORDER BY DRAFTING_DOC.DRAFTING_DATE DESC
	</select>

	<select id="selectByAll" resultType="com.spring.mvc.drafting_doc.Drafting_Dto">
	<![CDATA[ 
		 SELECT DRAFTING_DOC.DRAFTING_NUM, DRAFTING_DOC.DRAFTING_TITLE, DRAFTING_DOC.DRAFTING_CONTENT, DRAFTING_DOC.DRAFTING_DATE, DRAFTING_DOC.APPROVAL_CATEGORY_NUM, DRAFTING_DOC.MEMBER_ID,MEMBER.MEMBER_ID, CONDITION.CONDITION_NAME, GROUP_TB.GROUP_NUM, GROUP_TB.GROUP_NAME, POSITION.POSITION_NUM, POSITION.POSITION_NAME, MEMBER.MEMBER_NAME 
		 FROM DRAFTING_DOC, CONDITION, GROUP_TB, POSITION, MEMBER 
		 WHERE DRAFTING_DOC.CONDITION_NUM = CONDITION.CONDITION_NUM  AND MEMBER.GROUP_NUM = GROUP_TB.GROUP_NUM AND MEMBER.POSITION_NUM = POSITION.POSITION_NUM AND MEMBER.MEMBER_ID = DRAFTING_DOC.MEMBER_ID
		 AND ((CONDITION.CONDITION_NUM = 1 or CONDITION.CONDITION_NUM = 3) AND ( MEMBER.MEMBER_ID = #{param1}  or (#{param2} = GROUP_TB.GROUP_NUM AND #{param3} >=3) or #{param3} >= 4))  
		 ORDER BY DRAFTING_DOC.DRAFTING_DATE DESC
	]]>
	</select>
	 
	
	
	<!-- <select id="selectByAll" resultType="com.spring.mvc.drafting_doc.Drafting_Dto">
	<![CDATA[ 
		 SELECT DRAFTING_DOC.DRAFTING_NUM, DRAFTING_DOC.DRAFTING_TITLE, DRAFTING_DOC.DRAFTING_CONTENT, DRAFTING_DOC.DRAFTING_DATE, DRAFTING_DOC.APPROVAL_CATEGORY_NUM, DRAFTING_DOC.MEMBER_ID,MEMBER.MEMBER_ID, CONDITION.CONDITION_NAME, GROUP_TB.GROUP_NUM, GROUP_TB.GROUP_NAME, POSITION.POSITION_NUM, POSITION.POSITION_NAME, DRAFTING_DOC.GROUP_NUM,DRAFTING_DOC.GROUP_NUM 
		 FROM DRAFTING_DOC, CONDITION, GROUP_TB, POSITION, MEMBER 
		 WHERE DRAFTING_DOC.CONDITION_NUM = CONDITION.CONDITION_NUM  AND MEMBER.GROUP_NUM = GROUP_TB.GROUP_NUM AND MEMBER.POSITION_NUM = POSITION.POSITION_NUM AND MEMBER.MEMBER_ID = DRAFTING_DOC.MEMBER_ID
		 AND ((CONDITION.CONDITION_NUM = 1 or CONDITION.CONDITION_NUM = 3) AND ( MEMBER.MEMBER_ID = #{param1}  or (MEMBER.GROUP_NUM = GROUP_TB.GROUP_NUM AND MEMBER.POSITION_NUM >=3) or MEMBER.POSITION_NUM >= 4))  
		 ORDER BY DRAFTING_DOC.DRAFTING_DATE DESC
	]]>
	</select> -->
	
	
	
	
	<select id="searchBytitle" resultType="com.spring.mvc.drafting_doc.Drafting_Dto">
		SELECT DRAFTING_DOC.DRAFTING_NUM, DRAFTING_DOC.DRAFTING_TITLE, DRAFTING_DOC.DRAFTING_CONTENT, DRAFTING_DOC.DRAFTING_DATE, DRAFTING_DOC.APPROVAL_CATEGORY_NUM, DRAFTING_DOC.MEMBER_ID,MEMBER.MEMBER_ID, CONDITION.CONDITION_NAME, GROUP_TB.GROUP_NUM, GROUP_TB.GROUP_NAME, POSITION.POSITION_NUM, POSITION.POSITION_NAME, MEMBER.MEMBER_NAME 
		 FROM DRAFTING_DOC, CONDITION, GROUP_TB, POSITION, MEMBER 
		 WHERE DRAFTING_DOC.CONDITION_NUM = CONDITION.CONDITION_NUM  AND MEMBER.GROUP_NUM = GROUP_TB.GROUP_NUM AND MEMBER.POSITION_NUM = POSITION.POSITION_NUM AND MEMBER.MEMBER_ID = DRAFTING_DOC.MEMBER_ID
		 AND ((CONDITION.CONDITION_NUM = 2) AND ( MEMBER.MEMBER_ID = #{param1}  or (#{param2} = GROUP_TB.GROUP_NUM AND #{param3} >=3) or #{param3} >= 4))  AND DRAFTING_DOC.DRAFTING_TITLE LIKE #{param4}
		 ORDER BY DRAFTING_DOC.DRAFTING_DATE DESC
	</select>
	
	<select id="searchBydate" resultType="com.spring.mvc.drafting_doc.Drafting_Dto">
		SELECT DRAFTING_DOC.DRAFTING_NUM, DRAFTING_DOC.DRAFTING_TITLE, DRAFTING_DOC.DRAFTING_CONTENT, DRAFTING_DOC.DRAFTING_DATE, DRAFTING_DOC.APPROVAL_CATEGORY_NUM, DRAFTING_DOC.MEMBER_ID,MEMBER.MEMBER_ID, CONDITION.CONDITION_NAME, GROUP_TB.GROUP_NUM, GROUP_TB.GROUP_NAME, POSITION.POSITION_NUM, POSITION.POSITION_NAME, MEMBER.MEMBER_NAME
		 FROM DRAFTING_DOC, CONDITION, GROUP_TB, POSITION, MEMBER 
		 WHERE DRAFTING_DOC.CONDITION_NUM = CONDITION.CONDITION_NUM  AND MEMBER.GROUP_NUM = GROUP_TB.GROUP_NUM AND MEMBER.POSITION_NUM = POSITION.POSITION_NUM AND MEMBER.MEMBER_ID = DRAFTING_DOC.MEMBER_ID
		 AND ((CONDITION.CONDITION_NUM = 2) AND ( MEMBER.MEMBER_ID = #{param1}  or (#{param2} = GROUP_TB.GROUP_NUM AND #{param3} >=3) or #{param3} >= 4))  AND TO_CHAR(DRAFTING_DATE, 'yyyy-mm-dd') BETWEEN #{param4} AND #{param4}
		 ORDER BY DRAFTING_DOC.DRAFTING_DATE DESC
	</select>
	
	
<!-- 결제선관련 쿼리 
	
	<select id="selectapproval" resultType="com.spring.mvc.drafting_doc.Drafting_Dto">
	SELECT MEMBER.MEMBER_NAME,MEMBER.GROUP_NUM,GROUP_TB.GROUP_NAME, MEMBER.POSITION_NUM,POSITION.POSITION_NAME
	FROM MEMBER, GROUP_TB, POSITION
	WHERE MEMBER.GROUP_NUM = GROUP_TB.GROUP_NUM AND MEMBER.POSITION_NUM = POSITION.POSITION_NUM
	ORDER BY GROUP_TB.GROUP_NUM ASC,POSITION.POSITION_NUM DESC
	</select>
	<select id = "select1" resultType="com.spring.mvc.drafting_doc.Drafting_Dto">
	SELECT MEMBER.MEMBER_NAME,POSITION.POSITION_NAME
	FROM MEMBER,GROUP_TB,POSITION
	WHERE MEMBER.GROUP_NUM = GROUP_TB.GROUP_NUM AND MEMBER.POSITION_NUM = POSITION.POSITION_NUM AND GROUP_TB.GROUP_NUM = 1
	ORDER BY POSITION.POSITION_NUM DESC
	</select>
	<select id = "select2" resultType="com.spring.mvc.drafting_doc.Drafting_Dto">
	SELECT MEMBER.MEMBER_NAME,POSITION.POSITION_NAME
	FROM MEMBER,GROUP_TB,POSITION
	WHERE MEMBER.GROUP_NUM = GROUP_TB.GROUP_NUM AND MEMBER.POSITION_NUM = POSITION.POSITION_NUM AND GROUP_TB.GROUP_NUM = 2
	ORDER BY POSITION.POSITION_NUM DESC
	</select>
	<select id = "select3" resultType="com.spring.mvc.drafting_doc.Drafting_Dto">
	SELECT MEMBER.MEMBER_NAME,POSITION.POSITION_NAME
	FROM MEMBER,GROUP_TB,POSITION
	WHERE MEMBER.GROUP_NUM = GROUP_TB.GROUP_NUM AND MEMBER.POSITION_NUM = POSITION.POSITION_NUM AND GROUP_TB.GROUP_NUM = 3
	ORDER BY POSITION.POSITION_NUM DESC
	</select>
	-->
	
	<select id="mainList" resultType="com.spring.mvc.drafting_doc.Drafting_Dto">
		select * from DRAFTING_DOC, member, GROUP_TB, POSITION  where <![CDATA[ rownum <= 5 ]]> AND MEMBER.GROUP_NUM = GROUP_TB.GROUP_NUM AND MEMBER.POSITION_NUM = POSITION.POSITION_NUM AND MEMBER.MEMBER_ID = DRAFTING_DOC.MEMBER_ID
		AND (MEMBER.MEMBER_ID = #{param1} or (#{param2} = GROUP_TB.GROUP_NUM AND #{param3} >=3) or #{param3} >= 4)
		order by DRAFTING_NUM desc
	</select>
	
</mapper>